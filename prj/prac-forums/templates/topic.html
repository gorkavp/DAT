<nav class="bg-light mb-3">
  <a href="@{HomeR}">Home</a> / <a href="@{ForumR fid}">#{ fdTitle forum }</a> /
  <span>#{ tdSubject topic }</span>
</nav>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">#{ tdSubject topic }</h3>
  </div>
  <div class="panel-footer">
    <p>
      <span class="small">Per: ^{ uidNameWidget (tdUserId topic) }</span>
      <span class="small">Iniciada: ^{ dateWidget (tdStarted topic) }</span>
      <span class="small">Posts: #{ tdPostCount topic }</span>
    </p>
  </div>
</div>

<table class="table table-striped table-condensed">
  <thead>
    <tr>
      <th>Per</th>
      <th>Post</th>
      <th>Enviat</th>
    </tr>
  </thead>
  <tbody>
    $forall{ (pid, post) <- posts }
    <tr>
      <td>^{ uidNameWidget (pdUserId post) }</td>
      <td><a href="@{PostR pid}">#{ pdMessage post }</a></td>
      <td>^{ dateWidget (pdPosted post) }</td>
    </tr>
    $end
  </tbody>
</table>

$if{ isJust mbuser }
<div class="row">
  <div class="col-sm-12">
    <form role="form" method="POST" action="@{TopicR tid}">
      ^{pformw}
      <button type="submit" class="btn btn-success">Nova resposta</button>
    </form>
  </div>
  <div class="col-sm-12 text-left mt-3">
    <button type="button" class="btn btn-danger" onClick="deleteTopic()">
      Eliminar q체esti처
    </button>
  </div>
</div>
$end

<script type="text/javascript">
  function deleteTopic() {
    if (confirm("Segur que vols eliminar aquesta q체esti처?")) {
      fetch("@{TopicR tid}", { method: "DELETE" }).then(function (response) {
        window.location.href = "@{ForumR fid}";
      });
    }
  }
</script>
