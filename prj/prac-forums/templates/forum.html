<nav class="bg-light mb-3">
  <a href="@{HomeR}">Home</a> / <span>#{ fdTitle forum }</span>
</nav>

<div class="panel panel-default">
  <div class="panel-heading">
    <h2 class="panel-title">#{ fdTitle forum }</h2>
  </div>
  <div class="panel-body">
    <p>#{ fdDescription forum }</p>
  </div>
</div>
<div class="panel-footer">
  <p>
    <span class="small"
      >Moderador: ^{ uidNameWidget (fdModeratorId forum) }</span
    >
    <span class="small">Creat: ^{ dateWidget (fdCreated forum) }</span>
    <span class="small">Topics: #{ fdTopicCount forum }</span>
    <span class="small">Posts: #{ fdPostCount forum }</span>
  </p>
</div>

<table class="table table-striped table-condensed">
  <thead>
    <tr>
      <th>Categoria</th>
      <th>Títol</th>
      <th>Moderador</th>
      <th>Creat</th>
      <th>Topics</th>
      <th>Posts</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>#{ fdCategory forum }</td>
      <td>#{ fdTitle forum }</td>
      <td>^{ uidNameWidget (fdModeratorId forum) }</td>
      <td>^{ dateWidget (fdCreated forum) }</td>
      <td>#{ fdTopicCount forum }</td>
      <td>#{ fdPostCount forum }</td>
    </tr>
  </tbody>
</table>

<p>Topics:</p>
<table class="table table-striped table-condensed">
  <thead>
    <tr>
      <th>Qüestió</th>
      <th>Per / Iniciada</th>
      <th>Posts</th>
      <th>Última activitat</th>
    </tr>
  </thead>
  <tbody>
    $forall{ (tid, topic) <- topics }
    <tr>
      <td>
        <a href="@{TopicR tid}"><strong>#{ tdSubject topic }</strong></a>
      </td>
      <td>
        ^{ uidNameWidget (tdUserId topic) } /
        <span class="small">^{ dateWidget (tdStarted topic) }</span>
      </td>
      <td>#{ tdPostCount topic }</td>
      <td>
        $maybe{ lastpid <- tdLastPostId topic } ^{pidPostedWidget lastpid} $end
      </td>
    </tr>
    $end
  </tbody>
</table>

$if{ isJust mbuser }
<div class="row">
  <div class="col-sm-12">
    <form role="form" method="POST" action="@{ForumR fid}">
      ^{tformw}
      <button type="submit" class="btn btn-success">Nova qüestió</button>
    </form>
  </div>
  <div class="col-sm-12 text-left mt-3">
    <button type="button" class="btn btn-danger" onClick="deleteForum()">
      Eliminar fòrum
    </button>
  </div>
</div>
$end

<script type="text/javascript">
  function deleteForum() {
    if (confirm("Segur que vols eliminar aquest fòrum?")) {
      fetch("@{ForumR fid}", { method: "DELETE" }).then((response) => {
        window.location.href = "@{HomeR}";
      });
    }
  }
</script>
